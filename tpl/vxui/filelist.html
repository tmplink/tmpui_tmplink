<!-- VXUI FileList Module Template - 支持列表/相册双视图 -->
<link rel="stylesheet" href="/css/photo-album.css">
<link rel="stylesheet" href="/css/vxui/filelist.css">
<link rel="stylesheet" href="/css/vxui/filelist-mobile-fix.css">

<!-- Drag Overlay -->
<div class="vx-drag-overlay" id="vx-drag-overlay">
    <div class="vx-drag-overlay-content">
        <div class="vx-drag-overlay-icon">
            <iconpark-icon name="cloud-arrow-up"></iconpark-icon>
        </div>
        <div class="vx-drag-overlay-text" data-tpl="vx_drop_to_upload">松开以上传文件</div>
    </div>
</div>

<!-- Dynamic Sidebar Content -->
<template id="vx-filelist-sidebar-tpl">
    <!-- Current Folder Info -->
    <div class="vx-nav-section">
        <div class="vx-nav-title" data-tpl="vx_current_folder">当前文件夹</div>
        <div class="vx-sidebar-module-info">
            <h3 class="vx-sidebar-folder-name" id="vx-fl-sidebar-title" data-tpl="navbar_meetingroom">桌面</h3>
            <div class="vx-sidebar-meta">
                <iconpark-icon name="folder-open-e1ad2j7l"></iconpark-icon>
                <span id="vx-fl-item-count">0</span> <span data-tpl="vx_item_unit">项</span>
            </div>
        </div>
    </div>

    <!-- Folder Privacy (public/private) -->
    <div class="vx-nav-section" id="vx-fl-privacy-section" style="display:none;">
        <div class="vx-nav-title" data-tpl="vx_folder_privacy">文件夹权限</div>
        <div class="vx-sidebar-module-info">
            <div style="display:flex; align-items:center; justify-content: space-between; gap: 12px;">
                <div style="min-width:0;">
                    <div class="vx-text-sm" id="vx-fl-privacy-state" data-tpl="vx_privacy_public">公开</div>
                    <div class="vx-text-muted" style="margin-top: 4px; font-size: var(--vx-text-xs);">
                        <span id="vx-fl-privacy-hint" i18n="modal_meetingroom_type1" i18n-only="html">公开，所有人都可访问。</span>
                    </div>
                </div>
                <label class="vx-switch" style="flex-shrink:0;">
                    <input type="checkbox" id="vx-fl-privacy-toggle" onchange="VX_FILELIST.onFolderPrivacyToggleChange(this.checked)">
                    <span class="vx-switch-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Folder Publish (Search Engine Indexing) -->
    <div class="vx-nav-section" id="vx-fl-publish-section" style="display:none;">
        <div class="vx-nav-title" data-tpl="modal_performance_publish">允许被搜索</div>
        <div class="vx-sidebar-module-info">
            <div style="display:flex; align-items:center; justify-content: space-between; gap: 12px;">
                <div style="min-width:0;">
                    <div class="vx-text-sm" id="vx-fl-publish-status" data-tpl="modal_performance_publish">允许被搜索</div>
                    <div class="vx-text-muted" style="margin-top: 4px; font-size: var(--vx-text-xs);">
                        <span id="vx-fl-publish-hint" i18n="modal_performance_publish_des" i18n-only="html">启用后，其他用户可以通过搜索引擎找到此目录内的文件。</span>
                    </div>
                </div>
                <label class="vx-switch" style="flex-shrink:0;">
                    <input type="checkbox" id="vx-fl-publish-toggle" onchange="VX_FILELIST.onFolderPublishToggleChange(this.checked)">
                    <span class="vx-switch-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Direct Controls (folder share) -->
    <div class="vx-nav-section" id="vx-fl-direct-section" style="display:none;">
        <div class="vx-nav-title" data-tpl="nav_direct">直链</div>
        <div class="vx-sidebar-module-info">
            <div style="display:flex; align-items:center; justify-content: space-between; gap: 12px;">
                <div style="min-width:0;">
                    <div class="vx-text-sm" data-tpl="vx_allow_folder_direct_link">允许文件夹直链</div>
                </div>
                <label class="vx-switch" style="flex-shrink:0;">
                    <input type="checkbox" id="vx-fl-direct-toggle" onchange="VX_FILELIST.toggleDirectForFolder()">
                    <span class="vx-switch-slider"></span>
                </label>
            </div>
            <div id="vx-fl-direct-disabled" class="vx-text-muted" style="margin-top: 8px; font-size: var(--vx-text-xs); display:none;">
                <span data-tpl="vx_bind_direct_domain_first">请先在直链模块绑定域名。</span>
            </div>
            <div id="vx-fl-direct-link-wrap" style="margin-top: 10px; display:none;">
                <div id="vx-fl-direct-link" style="padding: 8px 10px; background: var(--vx-bg-secondary); border-radius: var(--vx-radius); font-family: var(--vx-font-mono); font-size: var(--vx-text-xs); user-select: all; word-break: break-all;"></div>
                <div style="display:flex; gap: 8px; margin-top: 8px;">
                    <button class="vx-btn vx-btn-ghost" onclick="VX_FILELIST.copyFolderDirectLink()" title="复制">
                        <iconpark-icon name="copy"></iconpark-icon>
                        <span data-tpl="copy">复制</span>
                    </button>
                    <button class="vx-btn vx-btn-ghost" onclick="VX_FILELIST.openFolderDirectLink()" title="打开">
                        <iconpark-icon name="link"></iconpark-icon>
                        <span data-tpl="vx_open">打开</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- Header -->
<header class="vx-header vx-header-minimal">
    <div class="vx-header-left">
        <button class="vx-btn-icon vx-portrait-sidebar-btn" onclick="VXUI.toggleSidebar()" title="." i18n="vx_menu" i18n-only="title">
            <iconpark-icon name="bars"></iconpark-icon>
        </button>
        <button class="vx-btn-icon vx-btn-outline" onclick="VX_FILELIST.goToParent()" id="vx-fl-back-btn" style="display: none;" title="." i18n="vx_back" i18n-only="title">
            <iconpark-icon name="arrow-circle-left"></iconpark-icon>
        </button>
        <nav class="vx-breadcrumb" id="vx-fl-breadcrumb">
            <a href="javascript:;" onclick="VX_FILELIST.openFolder(0)"><span data-tpl="navbar_meetingroom">桌面</span></a>
        </nav>
    </div>
    
    <div class="vx-header-right">
        <!-- 视图切换按钮组 -->
        <div class="vx-btn-group vx-view-toggle">
            <button class="vx-btn-icon active" id="vx-fl-view-list" onclick="VX_FILELIST.setViewMode('list')" title="." i18n="vx_view_list" i18n-only="title">
                <iconpark-icon name="list"></iconpark-icon>
            </button>
            <button class="vx-btn-icon" id="vx-fl-view-album" onclick="VX_FILELIST.setViewMode('album')" title="." i18n="vx_view_album" i18n-only="title">
                <iconpark-icon name="picture"></iconpark-icon>
            </button>
        </div>
        
        <!-- 相册模式下的网格大小控制 -->
        <div class="vx-btn-group vx-album-controls" id="vx-fl-album-controls" style="display: none;">
            <button class="vx-btn-icon" onclick="VX_FILELIST.setGridSize('normal')" id="view-normal" title="." i18n="album_grid_normal" i18n-only="title">
                <iconpark-icon name="application-two"></iconpark-icon>
            </button>
            <button class="vx-btn-icon active" onclick="VX_FILELIST.setGridSize('small')" id="view-small" title="." i18n="album_grid_small" i18n-only="title">
                <iconpark-icon name="application-menu"></iconpark-icon>
            </button>
        </div>

        <button class="vx-btn vx-btn-ghost" data-auth="logged-in" data-owner="true" onclick="VX_FILELIST.upload()" title="." i18n="nav_upload" i18n-only="title">
            <iconpark-icon name="cloud-arrow-up"></iconpark-icon>
            <span data-tpl="nav_upload">上传文件</span>
        </button>
        <button class="vx-btn vx-btn-ghost" data-auth="logged-in" data-owner="true" onclick="VX_FILELIST.showCreateModal()" title="." i18n="model_title_folder_title" i18n-only="title">
            <iconpark-icon name="folder-plus"></iconpark-icon>
            <span data-tpl="model_title_folder_title">新建文件夹</span>
        </button>
        <button class="vx-btn vx-btn-ghost vx-btn-outline" id="vx-fl-share-lnk-btn" onclick="VX_FILELIST.shareFolder()" title="." i18n="on_select_share" i18n-only="title" style="display:none;">
            <iconpark-icon name="share-from-square"></iconpark-icon>
            <span data-tpl="model_copy">分享</span>
        </button>
        <button class="vx-btn vx-btn-ghost vx-btn-outline" id="vx-fl-refresh-btn" onclick="VX_FILELIST.refresh()" title="." i18n="album_refresh" i18n-only="title">
            <iconpark-icon name="rotate" data-role="refresh-icon"></iconpark-icon>
            <span data-role="refresh-text" data-tpl="album_refresh">刷新</span>
        </button>
        <button class="vx-btn vx-btn-ghost vx-text-danger" id="vx-fl-report-btn" onclick="VX_FILELIST.openFolderReportModal()" title="." i18n="file_btn_report" i18n-only="title" style="display:none;">
            <iconpark-icon name="circle-exclamation"></iconpark-icon>
            <span class="vx-hide-mobile" data-tpl="file_btn_report">举报</span>
        </button>
    </div>
</header>

<!-- Content -->
<div class="vx-content vx-content-list">
    <!-- Loading State (Skeleton) -->
    <div class="vx-loading" id="vx-fl-loading">
        <div class="vx-skeleton-list">
            <div class="vx-skeleton-header">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 150px; flex: inherit;"></div>
                <div class="vx-skeleton-bone vx-skeleton-text"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
            <div class="vx-skeleton-row">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-icon"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 60%"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
            <div class="vx-skeleton-row">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-icon"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 45%"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
            <div class="vx-skeleton-row">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-icon"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 70%"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
            <div class="vx-skeleton-row">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-icon"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 50%"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
            <div class="vx-skeleton-row">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-icon"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 55%"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
            <div class="vx-skeleton-row">
                <div class="vx-skeleton-bone vx-skeleton-checkbox"></div>
                <div class="vx-skeleton-bone vx-skeleton-icon"></div>
                <div class="vx-skeleton-bone vx-skeleton-text" style="width: 40%"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-sm size"></div>
                <div class="vx-skeleton-bone vx-skeleton-text-date"></div>
            </div>
        </div>
    </div>
    
    <!-- 列表视图容器 -->
    <div class="vx-list-container" id="vx-fl-list" style="display: none;">
        <!-- List Header -->
        <div class="vx-list-header">
            <div class="vx-list-col vx-list-col-name">
                <div class="vx-list-checkbox" id="vx-fl-select-all" onclick="event.stopPropagation(); VX_FILELIST.toggleSelectAllFromHeader()" title="." i18n="on_select_all" i18n-only="title"></div>
                <span data-tpl="filename">文件名</span>
            </div>
            <div class="vx-list-col vx-list-col-size">
                <span data-tpl="filesize">大小</span>
            </div>
            <div class="vx-list-col vx-list-col-date vx-hide-mobile">
                <span data-tpl="filedate">日期</span>
            </div>
            <div class="vx-list-col vx-list-col-actions">
                <span data-tpl="actions">操作</span>
            </div>
        </div>
        
        <!-- List Body -->
        <div class="vx-list-body" id="vx-fl-list-body">
            <!-- Items will be inserted here -->
        </div>
    </div>
    
    <!-- 相册视图容器 -->
    <div class="vx-album-container" id="vx-fl-album" style="display: none;">
        <div class="album-grid" id="vx-fl-album-grid">
            <!-- Photos and folders will be inserted here -->
        </div>
    </div>
    
    <!-- Empty State -->
    <div class="vx-empty" id="vx-fl-empty" style="display: none;">
        <div class="vx-empty-icon">
            <iconpark-icon name="folder-open-e1ad2j7l"></iconpark-icon>
        </div>
        <h3 class="vx-empty-title" data-tpl="vx_empty_folder_title">空文件夹</h3>
        <p class="vx-empty-text" data-tpl="page_no_files">拖放文件到这里或点击上传按钮</p>
        <button class="vx-btn vx-btn-primary" data-auth="logged-in" data-owner="true" onclick="VX_FILELIST.upload()">
            <iconpark-icon name="cloud-arrow-up"></iconpark-icon>
            <span data-tpl="nav_upload">上传文件</span>
        </button>
    </div>
</div>

<!-- Sponsor Inline (Non-owner) -->
<div class="vx-fl-sponsor-card userinfo" id="vx-fl-sponsor-card" style="display: none;">
    <div class="vx-fl-sponsor-avatar">
        <img class="userinfo_avatar_card_img" src="/img/loading.svg" alt="Avatar">
    </div>
    <div class="vx-fl-sponsor-name">
        <span class="userinfo_nickname userinfo_card_nickname"></span>
        <span class="userinfo_pro userinfo_card_pro" style="display: none;">
            <iconpark-icon name="circle-check"></iconpark-icon>
        </span>
        <span class="userinfo_sd" style="display: none;"></span>
    </div>
</div>

<!-- Selection Bar -->
<div class="vx-selection-bar" id="vx-fl-selection-bar" style="display: none;">
    <div class="vx-selection-info">
        <span class="vx-selection-count"><span data-tpl="vx_selected_prefix">已选择</span> <strong id="vx-fl-selected-count">0</strong> <span data-tpl="vx_item_unit">项</span></span>
    </div>
    <div class="vx-selection-actions">
        <button class="vx-btn vx-btn-ghost vx-action-download" onclick="VX_FILELIST.downloadSelected()">
            <iconpark-icon name="cloud-arrow-down"></iconpark-icon>
            <span data-tpl="on_select_download">下载</span>
        </button>
        <button class="vx-btn vx-btn-ghost" data-auth="logged-in" data-owner="true" onclick="VX_FILELIST.moveSelected()">
            <iconpark-icon name="folder-plus"></iconpark-icon>
            <span data-tpl="on_select_move">移动</span>
        </button>
        <button class="vx-btn vx-btn-ghost vx-text-danger" data-auth="logged-in" data-owner="true" onclick="VX_FILELIST.deleteSelected()">
            <iconpark-icon name="trash"></iconpark-icon>
            <span data-tpl="on_select_delete">删除</span>
        </button>
        <button class="vx-btn vx-btn-ghost" onclick="VX_FILELIST.clearSelection()">
            <span data-tpl="on_select_cancel">取消</span>
        </button>
    </div>
</div>

<!-- 批量下载 -->
<div class="vx-modal" id="multipleDownloadModel">
    <div class="vx-modal-overlay" onclick="VX_DOWNLOAD.closeModal()"></div>
    <div class="vx-modal-container vx-modal-lg">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title">
                <iconpark-icon name="laptop-arrow-down"></iconpark-icon>
                <span i18n="multi_download_modal_title">下载管理器</span>
            </h3>
            <button class="vx-modal-close" onclick="VX_DOWNLOAD.closeModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <div id="multiple_download_prepare" style="text-align: center;">
                <img src="/img/loading-outline.svg" style="height:120px;" />
            </div>
            <div id="multiple_download_processing" style="display: none;">
                <div class="vx-progress" style="height: 10px; background: var(--vx-border-color); border-radius: 5px; overflow: hidden;">
                    <div class="vx-progress-bar" id="multiple_download_process-bar" 
                        style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--vx-primary-color), var(--vx-primary-hover)); transition: width 0.3s ease;"></div>
                </div>
                <div id="multiple_download_info" style="margin-top: 1rem; font-family: monospace; max-height: 50vh; overflow-y: auto;">
                </div>
            </div>
        </div>
        <div class="vx-modal-footer">
            <button class="vx-btn vx-btn-secondary" onclick="VX_DOWNLOAD.closeModal()" data-tpl="model_btn_cancel">取消</button>
        </div>
    </div>
</div>

<!-- Context Menu -->
<div class="vx-context-menu" id="vx-fl-context-menu">
    <div class="vx-context-item" id="vx-fl-menu-open" onclick="VX_FILELIST.openContextItem()">
        <iconpark-icon name="folder-open-e1ad2j7l"></iconpark-icon>
        <span data-tpl="vx_open">打开</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-download" onclick="VX_FILELIST.downloadContextItem()">
        <iconpark-icon name="cloud-arrow-down"></iconpark-icon>
        <span data-tpl="on_select_download">下载</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-rename" onclick="VX_FILELIST.renameContextItem()">
        <iconpark-icon name="pen-to-square"></iconpark-icon>
        <span data-tpl="menu_rename">重命名</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-direct-share" onclick="VX_FILELIST.directShareContextItem()">
        <iconpark-icon name="share-from-square"></iconpark-icon>
        <span data-tpl="vx_direct_share">通过直链分享</span>
    </div>

    <!-- Video Stream Options (Sponsor Only) -->
    <div class="vx-context-divider" id="vx-fl-menu-stream-divider" style="display:none;"></div>
    <div class="vx-context-label" id="vx-fl-menu-stream-label" style="display:none;" data-tpl="file_btn_play">在线观看</div>
    <div class="vx-context-item" id="vx-fl-menu-stream-browser" style="display:none;" onclick="VX_FILELIST.streamContextItem('web')">
        <iconpark-icon name="browser"></iconpark-icon>
        <span>Browser</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-stream-potplayer" style="display:none;" onclick="VX_FILELIST.streamContextItem('potplayer')">
        <iconpark-icon name="send-backward"></iconpark-icon>
        <span>PotPlayer</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-stream-iina" style="display:none;" onclick="VX_FILELIST.streamContextItem('iina')">
        <iconpark-icon name="send-backward"></iconpark-icon>
        <span>IINA</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-stream-nplayer" style="display:none;" onclick="VX_FILELIST.streamContextItem('nplayer')">
        <iconpark-icon name="send-backward"></iconpark-icon>
        <span>nPlayer</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-stream-copy" style="display:none;" onclick="VX_FILELIST.streamContextItem('copy')">
        <iconpark-icon name="copy"></iconpark-icon>
        <span>Stream URL</span>
    </div>

    <div class="vx-context-divider" id="vx-fl-menu-expire-divider"></div>
    <div class="vx-context-label" id="vx-fl-menu-expire-label" data-tpl="on_select_change_model">修改有效期</div>
    <div class="vx-context-item" id="vx-fl-menu-expire-3" onclick="VX_FILELIST.setExpireContextItem(99)">
        <iconpark-icon name="infinity"></iconpark-icon>
        <span data-tpl="modal_settings_upload_model99">永久保存</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-expire-0" onclick="VX_FILELIST.setExpireContextItem(0)">
        <iconpark-icon name="clock"></iconpark-icon>
        <span data-tpl="modal_settings_upload_model1">24 小时</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-expire-1" onclick="VX_FILELIST.setExpireContextItem(1)">
        <iconpark-icon name="clock"></iconpark-icon>
        <span data-tpl="modal_settings_upload_model2">3 天</span>
    </div>
    <div class="vx-context-item" id="vx-fl-menu-expire-2" onclick="VX_FILELIST.setExpireContextItem(2)">
        <iconpark-icon name="clock"></iconpark-icon>
        <span data-tpl="modal_settings_upload_model3">7 天</span>
    </div>

    <div class="vx-context-divider"></div>
    <div class="vx-context-item vx-text-danger" id="vx-fl-menu-delete" onclick="VX_FILELIST.deleteContextItem()">
        <iconpark-icon name="trash"></iconpark-icon>
        <span data-tpl="menu_delete">删除</span>
    </div>
</div>

<!-- Create Folder Modal -->
<div class="vx-modal" id="vx-fl-create-modal">
    <div class="vx-modal-overlay" onclick="VX_FILELIST.closeCreateModal()"></div>
    <div class="vx-modal-container">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title" data-tpl="model_title_folder_title">新建文件夹</h3>
            <button class="vx-modal-close" onclick="VX_FILELIST.closeCreateModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <div class="vx-text-sm vx-text-muted vx-mb-md" data-tpl="vx_create_folder_notice">创建新的文件夹</div>
            <div class="vx-form-group">
                <label class="vx-label" data-tpl="model_meetingroom_create_name">文件夹名称</label>
                <input type="text" class="vx-input" id="vx-fl-folder-name" data-tpl="model_title_folder_name" placeholder="请输入文件夹名称">
            </div>
            <div class="vx-form-group">
                <label class="vx-label" i18n="modal_meetingroom_create_type">权限</label>
                <select class="vx-select" id="vx-fl-folder-model">
                    <option value="0" i18n-only="html" i18n="modal_meetingroom_type1">公开，所有人都可访问。</option>
                    <option value="1" i18n-only="html" i18n="modal_meetingroom_type2">私有，仅自己可访问。</option>
                </select>
            </div>
        </div>
        <div class="vx-modal-footer">
            <button class="vx-btn vx-btn-secondary" onclick="VX_FILELIST.closeCreateModal()" data-tpl="model_btn_close">取消</button>
            <button class="vx-btn vx-btn-primary" onclick="VX_FILELIST.createFolder()" data-tpl="model_btn_create">创建</button>
        </div>
    </div>
</div>

<!-- Rename Modal -->
<div class="vx-modal" id="vx-fl-rename-modal">
    <div class="vx-modal-overlay" onclick="VX_FILELIST.closeRenameModal()"></div>
    <div class="vx-modal-container">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title" data-tpl="menu_rename">重命名</h3>
            <button class="vx-modal-close" onclick="VX_FILELIST.closeRenameModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <div class="vx-form-group">
                <label class="vx-label" data-tpl="vx_new_name">新名称</label>
                <input type="text" class="vx-input" id="vx-fl-rename-input">
            </div>
        </div>
        <div class="vx-modal-footer">
            <button class="vx-btn vx-btn-secondary" onclick="VX_FILELIST.closeRenameModal()" data-tpl="model_btn_close">取消</button>
            <button class="vx-btn vx-btn-primary" onclick="VX_FILELIST.confirmRename()" data-tpl="model_btn_confirm">确定</button>
        </div>
    </div>
</div>

<!-- Report Folder Modal -->
<div class="vx-modal" id="vx-fl-report-modal">
    <div class="vx-modal-overlay" onclick="VX_FILELIST.closeReportModal()"></div>
    <div class="vx-modal-container">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title" data-tpl="model_title_report">举报</h3>
            <button class="vx-modal-close" onclick="VX_FILELIST.closeReportModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <div class="vx-form-group">
                <label class="vx-label" data-tpl="modal_report_reason">举报原因</label>
                <select class="vx-select" id="vx-fl-report-reason">
                    <option value="copyright" i18n-only="html" i18n="modal_report_reason1">.</option>
                    <option value="nsfw" i18n-only="html" i18n="modal_report_reason2">.</option>
                    <option value="privacy" i18n-only="html" i18n="modal_report_reason3">.</option>
                </select>
            </div>
        </div>
        <div class="vx-modal-footer">
            <button class="vx-btn vx-btn-secondary" onclick="VX_FILELIST.closeReportModal()" data-tpl="model_btn_cancel">取消</button>
            <button class="vx-btn vx-btn-primary" id="vx-fl-report-submit" onclick="VX_FILELIST.reportFolder()" data-tpl="modal_report_submit">提交</button>
        </div>
    </div>
</div>

<!-- Move to Folder Modal -->
<div class="vx-modal" id="vx-fl-move-modal">
    <div class="vx-modal-overlay" onclick="VX_FILELIST.closeMoveModal()"></div>
    <div class="vx-modal-container">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title" data-tpl="model_title_move_to">移动到文件夹</h3>
            <button class="vx-modal-close" onclick="VX_FILELIST.closeMoveModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <!-- 搜索框 -->
            <div class="vx-move-search-wrapper">
                <div class="vx-move-search-input-wrapper">
                    <iconpark-icon name="search" class="vx-move-search-icon"></iconpark-icon>
                    <input type="text" id="vx-move-search-input" class="vx-move-search-input" 
                              placeholder="搜索文件夹..." data-tpl="move_folder_search_placeholder"
                           oninput="VX_FILELIST.searchMoveFolder(this.value)">
                    <button type="button" id="vx-move-search-clear" class="vx-move-search-clear" 
                            onclick="VX_FILELIST.clearMoveSearch()" style="display: none;">
                        <iconpark-icon name="close-small"></iconpark-icon>
                    </button>
                </div>
            </div>
            
            <!-- 搜索结果区域 -->
            <div id="vx-move-search-results" class="vx-move-search-results" style="display: none;"></div>
            
            <!-- 树形结构区域 -->
            <div id="vx-move-tree-wrapper" class="vx-move-tree-wrapper">
                <div id="vx-move-tree-root" class="vx-move-tree-root"></div>
            </div>
            
            <!-- 加载状态 -->
            <div id="vx-move-loading" class="vx-move-loading" style="display: none;">
                <div class="vx-spinner"></div>
            </div>
        </div>
        <div class="vx-modal-footer">
            <button class="vx-btn vx-btn-secondary" onclick="VX_FILELIST.closeMoveModal()" data-tpl="model_btn_cancel">取消</button>
            <button class="vx-btn vx-btn-primary" onclick="VX_FILELIST.confirmMove()" data-tpl="model_btn_ok">确定</button>
        </div>
    </div>
</div>

<!-- Upload Modal -->
<div class="vx-modal" id="vx-upload-modal">
    <div class="vx-modal-overlay" onclick="VX_UPLOADER.closeModal()"></div>
    <div class="vx-modal-container vx-modal-lg">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title" data-tpl="model_title_upload">上传文件</h3>
            <button class="vx-modal-close" onclick="VX_UPLOADER.closeModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <!-- 当前设置 -->
            <div class="vx-upload-settings">
                <div class="vx-upload-settings-header">
                    <iconpark-icon name="circle-check" class="text-success"></iconpark-icon>
                    <span data-tpl="upload_settings_current">当前设置</span>
                </div>
                <div class="vx-upload-settings-grid">
                    <div class="vx-upload-setting-item">
                        <label class="vx-label" data-tpl="upload_settings_validity">文件有效期</label>
                        <select class="vx-select" id="vx-upload-model" onchange="VX_UPLOADER.onModelChange(this.value)">
                            <option value="0" data-tpl="modal_settings_upload_model1">24 小时</option>
                            <option value="1" selected data-tpl="modal_settings_upload_model2">3 天</option>
                            <option value="2" data-tpl="modal_settings_upload_model3">7 天</option>
                            <option value="99" data-tpl="modal_settings_upload_model99">永久保存</option>
                        </select>
                        <div class="vx-upload-setting-hint" data-tpl="modal_settings_upload_model2_des">将在有人下载时自动延长这个期限。</div>
                    </div>
                    <div class="vx-upload-setting-item">
                        <label class="vx-label" data-tpl="upload_settings_server">服务器</label>
                        <select class="vx-select" id="vx-upload-server" onchange="VX_UPLOADER.onServerChange(this.value)">
                            <!-- 服务器列表由JS填充 -->
                        </select>
                        <div class="vx-upload-setting-hint" data-tpl="model_title_upload_servers_des">赞助者专用功能</div>
                    </div>
                </div>
            </div>
            
            <!-- 上传区域 -->
            <div class="vx-upload-dropzone" id="vx-upload-dropzone">
                <div class="vx-upload-dropzone-icon">
                    <iconpark-icon name="cloud-arrow-up"></iconpark-icon>
                </div>
                <div class="vx-upload-dropzone-text" data-tpl="upload_or_drag">拖动文件到此位置，或者选择文件上传，或者按下 Ctrl + V 粘贴文件。</div>
                <div class="vx-upload-dropzone-actions">
                    <button class="vx-btn vx-btn-primary" onclick="VX_UPLOADER.selectFiles()">
                        <iconpark-icon name="folder-open-e1ad2j7l"></iconpark-icon>
                        <span data-tpl="model_btn_select">选择文件</span>
                    </button>
                    <button class="vx-btn vx-btn-secondary" onclick="VX_UPLOADER.selectFolder()">
                        <iconpark-icon name="folder-plus"></iconpark-icon>
                        <span data-tpl="upload_dirs">上传文件夹</span>
                    </button>
                    <button class="vx-btn vx-btn-secondary" onclick="VX_UPLOADER.openCliModal()">
                        <iconpark-icon name="rectangle-terminal"></iconpark-icon>
                        <span data-tpl="model_title_upload_cli">使用 CLI 上传</span>
                    </button>
                </div>
            </div>
            
            <!-- 隐藏的文件输入 -->
            <input type="file" id="vx-upload-file-input" multiple style="display: none;" onchange="VX_UPLOADER.onFilesSelected(this)">
            <input type="file" id="vx-upload-folder-input" webkitdirectory style="display: none;" onchange="VX_UPLOADER.onFolderSelected(this)">
        </div>
    </div>
</div>

<!-- CLI Upload Modal -->
<div class="vx-modal" id="vx-cli-modal">
    <div class="vx-modal-overlay" onclick="VX_UPLOADER.closeCliModal()"></div>
    <div class="vx-modal-container vx-modal-md">
        <div class="vx-modal-header">
            <h3 class="vx-modal-title" data-tpl="model_title_upload_cli">使用 CLI 上传</h3>
            <button class="vx-modal-close" onclick="VX_UPLOADER.closeCliModal()">
                <iconpark-icon name="circle-xmark"></iconpark-icon>
            </button>
        </div>
        <div class="vx-modal-body">
            <!-- 安全提醒 -->
            <div class="vx-cli-warning">
                <div class="vx-cli-warning-icon">
                    <iconpark-icon name="circle-exclamation"></iconpark-icon>
                </div>
                <div class="vx-cli-warning-content">
                    <div class="vx-cli-warning-title" data-tpl="model_cli_security_title">安全提醒：</div>
                    <div class="vx-cli-warning-text" data-tpl="model_cli_security_warning1">• Token 与此浏览器关联，在此浏览器退出账号登录后，Token 上的用户信息也会被清除</div>
                    <div class="vx-cli-warning-text" data-tpl="model_cli_security_warning2">• 不要将 Token 告诉任何第三方，或用于任何第三方软件</div>
                </div>
            </div>
            
            <!-- Token 展示区域 -->
            <div class="vx-cli-token-section">
                <div class="vx-cli-token-label">
                    <iconpark-icon name="lock"></iconpark-icon>
                    <span>TOKEN</span>
                </div>
                <div class="vx-cli-token-box">
                    <code class="vx-cli-token-value" id="vx-cli-token">Loading...</code>
                    <button class="vx-cli-token-copy" id="vx-cli-copy-btn" onclick="VX_UPLOADER.copyCliToken()">
                        <iconpark-icon name="copy"></iconpark-icon>
                        <span data-tpl="copy">复制</span>
                    </button>
                </div>
            </div>
            
            <!-- 说明链接 -->
            <div class="vx-cli-help-section">
                <a href="https://github.com/tmplink/tmplink_uploader" target="_blank" class="vx-cli-help-link">
                    <iconpark-icon name="share-from-square"></iconpark-icon>
                    <span data-tpl="model_title_upload_tmpup_des2">点击这里查看详细的使用方法</span>
                    <iconpark-icon name="chevron-right" class="vx-cli-external"></iconpark-icon>
                </a>
            </div>
            
            <!-- 使用说明 -->
            <div class="vx-cli-notes">
                <div class="vx-cli-notes-title">
                    <iconpark-icon name="circle-info"></iconpark-icon>
                    <span data-tpl="upload_notes_title">使用说明</span>
                </div>
                <ul class="vx-cli-notes-list">
                    <li data-tpl="model_upload_cli_note1">使用命令行上传文件需要 curl 的支持。</li>
                    <li data-tpl="model_upload_cli_note2">请注意，在文件上传完成前，请不要在本站退出登录，否则会导致上传失败。</li>
                    <li data-tpl="model_upload_cli_note3">请不要将 Token 透露其他人，因为 Token 等同于您在本站的身份信息。</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Lightbox for Album View -->
<div class="album-lightbox" id="vx-fl-lightbox">
    <header class="lightbox-header">
        <h2 class="lightbox-title" id="vx-fl-lightbox-title"></h2>
        <div class="lightbox-actions">
            <button class="lightbox-action" onclick="VX_FILELIST.downloadCurrentPhoto()" title="." i18n="on_select_download" i18n-only="title">
                <iconpark-icon name="cloud-arrow-down"></iconpark-icon>
            </button>
            <button class="lightbox-action" onclick="VX_FILELIST.rotateLightbox()" title="." i18n="vx_rotate" i18n-only="title">
                <iconpark-icon name="rotate"></iconpark-icon>
            </button>
            <button class="lightbox-action" onclick="VX_FILELIST.closeLightbox()" title="." i18n="btn_close" i18n-only="title">
                <iconpark-icon name="x-square"></iconpark-icon>
            </button>
        </div>
    </header>
    
    <div class="lightbox-content">
        <div class="lightbox-loading" id="vx-fl-lightbox-loading"></div>
        <img class="lightbox-image" id="vx-fl-lightbox-image" src="" alt="">
    </div>
    
    <button class="lightbox-nav prev" onclick="VX_FILELIST.lightboxPrev()">
        <iconpark-icon name="left-c"></iconpark-icon>
    </button>
    <button class="lightbox-nav next" onclick="VX_FILELIST.lightboxNext()">
        <iconpark-icon name="left-c" style="transform: rotate(180deg)"></iconpark-icon>
    </button>
    
    <footer class="lightbox-footer">
        <div class="lightbox-thumbnails" id="vx-fl-lightbox-thumbnails"></div>
        <span class="lightbox-counter" id="vx-fl-lightbox-counter">1 / 10</span>
    </footer>
</div>

<!-- Photo Card Template -->
<script type="text/template" id="tpl-vx-photo-card">
    <div class="photo-card" data-index="{index}" data-fid="{fid}" onclick="VX_FILELIST.photoCardClick(event, {index})">
        <img class="photo-card-image" src="{thumbnail}" alt="{name}" loading="lazy">
        <div class="photo-card-loading" data-role="photo-loading">
            <div class="photo-loading-spinner"></div>
        </div>
        <div class="photo-card-overlay">
            <div class="photo-card-info">
                <p class="photo-card-name">{name}</p>
                <div class="photo-card-meta">
                    <span>{size}</span>
                </div>
            </div>
        </div>
        <div class="photo-download-overlay">
            <div class="photo-download-progress">
                <div class="photo-download-progress-bar"></div>
            </div>
            <span class="photo-download-status" data-role="download-status"></span>
        </div>
        <div class="photo-card-actions">
            <button class="photo-card-action" data-role="download-btn" onclick="event.stopPropagation(); VX_FILELIST.downloadPhoto({index})" title="下载">
                <iconpark-icon name="cloud-arrow-down"></iconpark-icon>
            </button>
        </div>
        <div class="photo-card-select" onclick="event.stopPropagation(); VX_FILELIST.togglePhotoSelect({index})">
            <iconpark-icon name="check"></iconpark-icon>
        </div>
    </div>
</script>

<!-- Folder Card Template -->
<script type="text/template" id="tpl-vx-folder-card">
    <div class="album-folder-card" data-mrid="{mrid}" onclick="VX_FILELIST.openFolder('{mrid}')">
        <iconpark-icon name="folder-open-e1ad2j7l"></iconpark-icon>
        <span class="album-folder-card-name">{name}</span>
        <span class="album-folder-card-count">{count} 项</span>
    </div>
</script>
