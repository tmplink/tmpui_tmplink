<!-- VXUI Notes Module Template -->

<!-- Header -->
<header class="vx-header">
    <div class="vx-header-left">
        <button class="vx-btn-icon" onclick="VXUI.toggleSidebar()">
            <iconpark-icon name="bars"></iconpark-icon>
        </button>
        
        <h1 class="vx-text-xl vx-font-semibold" data-tpl="nav_notes">密记</h1>
    </div>
    
    <div class="vx-header-right vx-hidden" id="vx-notes-header-actions">
        <button class="vx-btn-icon" onclick="VX_NOTES.refresh()" title="刷新">
            <iconpark-icon name="rotate"></iconpark-icon>
        </button>
    </div>
</header>

<!-- Content -->
<div class="vx-content vx-p-0">
    <div class="vx-notes-layout">
        <!-- Notes List Sidebar -->
        <div class="vx-notes-sidebar vx-hidden" id="vx-notes-sidebar">
            <!-- Search -->
            <div class="vx-notes-search">
                <div class="vx-search vx-w-full">
                    <iconpark-icon name="search" class="vx-search-icon"></iconpark-icon>
                    <input type="text" class="vx-search-input" 
                        placeholder="搜索密记..." 
                        onkeyup="VX_NOTES.search(this.value)">
                </div>
            </div>
            
            <!-- Loading State -->
            <div class="vx-loading" id="vx-notes-loading">
                <div class="vx-spinner"></div>
                <span class="vx-loading-text" data-tpl="loading">加载中...</span>
            </div>
            
            <!-- Notes List -->
            <div id="vx-notes-content" class="vx-hidden">
                <div class="vx-notes-list" id="vx-notes-list">
                    <!-- Items will be rendered here -->
                </div>
            </div>
            
            <!-- Empty State -->
            <div class="vx-empty vx-hidden" id="vx-notes-empty" style="padding: 40px 20px;">
                <div class="vx-empty-icon" style="width: 60px; height: 60px;">
                    <iconpark-icon name="memo-pad" style="font-size: 30px;"></iconpark-icon>
                </div>
                <h3 class="vx-empty-title vx-text-lg">暂无密记</h3>
                <p class="vx-empty-text">点击上方按钮创建第一条密记</p>
            </div>
            
            <!-- Stats -->
            <div class="vx-notes-stats">
                <span id="vx-notes-count">0</span> 条密记
            </div>
        </div>
        
        <!-- Editor Area -->
        <div class="vx-notes-main">
            <!-- Main Loading State -->
            <div class="vx-notes-main-loading" id="vx-notes-main-loading">
                <div class="vx-loading">
                    <div class="vx-spinner"></div>
                    <span class="vx-loading-text" data-tpl="loading">加载中...</span>
                </div>
            </div>

            <!-- Key Setup / Key Error -->
            <div class="vx-notes-key" id="vx-notes-key">
                <div class="vx-notes-key-inner">
                    <div class="vx-card">
                        <div class="vx-card-header">
                            <div class="vx-flex vx-items-center vx-gap-sm">
                                <iconpark-icon name="lock"></iconpark-icon>
                                <div class="vx-card-title" data-tpl="title_notes">密记</div>
                            </div>
                        </div>
                        <div class="vx-card-body">
                            <div class="vx-notes-alert vx-notes-alert-danger vx-hidden" id="vx-notes-keyfail">
                                <iconpark-icon name="circle-exclamation"></iconpark-icon>
                                <span id="vx-notes-keyfail-text" data-tpl="notes_keyfail_alert">无效的密钥，无法解密密记内容。</span>
                            </div>

                            <div class="vx-notes-alert vx-notes-alert-warning vx-hidden" id="vx-notes-keyinit">
                                <iconpark-icon name="circle-exclamation"></iconpark-icon>
                                <span id="vx-notes-keyinit-text" data-tpl="notes_keyinit_alert">尚未设置密钥，请先设置密钥。</span>
                            </div>

                            <div class="vx-text-sm vx-font-semibold vx-mb-sm" data-tpl="notes_editor_key_title">密钥</div>
                            <input type="text" class="vx-input" id="vx-notes-key-input"
                                data-tpl="notes_editor_key_setting" placeholder="在这里填写您要设置的密钥">

                            <div class="vx-notes-key-desc">
                                <p data-tpl="notes_keyinit_des1">密钥在您登录期间会一直有效，退出登录时自动清除。</p>
                                <p data-tpl="notes_keyinit_des2">钛盘会使用密钥加密内容后存储到云端，并在需要时，从云端下载回来，再使用您设定好的密钥还原内容。钛盘无法知道您存储的内容。</p>
                            </div>

                            <div class="vx-notes-key-actions">
                                <button type="button" class="vx-btn vx-btn-danger vx-hidden" id="vx-notes-resetall" onclick="VX_NOTES.keyReInit()" data-tpl="model_btn_resetall">重置所有密记</button>
                                <button type="button" class="vx-btn vx-btn-primary" onclick="VX_NOTES.keySet()" data-tpl="model_btn_ok">确定</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Placeholder -->
            <div class="vx-notes-placeholder vx-hidden" id="vx-notes-placeholder">
                <div class="vx-empty">
                    <div class="vx-empty-icon">
                        <iconpark-icon name="memo-pad"></iconpark-icon>
                    </div>
                    <h3 class="vx-empty-title">选择或创建密记</h3>
                    <p class="vx-empty-text">从左侧列表选择一条密记，或创建新的密记</p>
                    <button class="vx-btn vx-btn-primary" onclick="VX_NOTES.createNote()">
                        <iconpark-icon name="circle-plus"></iconpark-icon>
                        <span data-tpl="notes_new">新建密记</span>
                    </button>
                </div>
            </div>

            <!-- Inline Editor (Trumbowyg) -->
            <div class="vx-notes-editor vx-hidden" id="vx-notes-editor">
                <div class="vx-notes-editor-header">
                    <input type="text" class="vx-notes-title-input" id="vx-notes-title"
                        data-tpl="notes_editor_title" placeholder="输入标题...">

                    <div class="vx-notes-editor-actions">
                        <span id="vx-notes-editor-updating" class="vx-hidden" title="保存中">
                            <iconpark-icon name="spinner" class="vx-spin vx-text-warning"></iconpark-icon>
                        </span>
                        <span id="vx-notes-editor-updated" class="vx-hidden" title="已保存">
                            <iconpark-icon name="circle-check" class="vx-text-success"></iconpark-icon>
                        </span>
                        <button class="vx-btn vx-btn-primary vx-btn-sm" onclick="VX_NOTES.saveCurrentNote()" data-tpl="user_save">保存</button>
                        <button class="vx-btn vx-btn-secondary vx-btn-sm" onclick="VX_NOTES.closeEditor()" data-tpl="model_btn_cancel">关闭</button>
                    </div>
                </div>
                <div class="vx-notes-editor-body" id="vx-notes-editor-body-wrap">
                    <textarea id="vx-notes-body"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Notes Module Specific Styles */
.vx-notes-layout {
    display: flex;
    height: calc(100vh - var(--vx-header-height));
}

.vx-notes-sidebar {
    width: 320px;
    border-right: 1px solid var(--vx-border);
    display: flex;
    flex-direction: column;
    background: var(--vx-surface);
    flex-shrink: 0;
}

.vx-notes-search {
    padding: 16px;
    border-bottom: 1px solid var(--vx-border);
}

.vx-notes-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
}

.vx-notes-item {
    position: relative;
    padding: 12px 16px;
    border-radius: var(--vx-radius);
    cursor: pointer;
    transition: var(--vx-transition-fast);
    margin-bottom: 4px;
}

.vx-notes-item:hover {
    background: var(--vx-surface-hover);
}

.vx-notes-item.active {
    background: var(--vx-primary-light);
}

.vx-notes-item-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 4px;
}

.vx-notes-item-title {
    font-size: var(--vx-text-sm);
    font-weight: 500;
    color: var(--vx-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
}

.vx-notes-item-time {
    font-size: var(--vx-text-xs);
    color: var(--vx-text-muted);
    flex-shrink: 0;
    margin-left: 8px;
}

.vx-notes-item-preview {
    font-size: var(--vx-text-xs);
    color: var(--vx-text-secondary);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.5;
}

.vx-notes-item-actions {
    position: absolute;
    top: 8px;
    right: 8px;
    opacity: 0;
    transition: var(--vx-transition-fast);
    z-index: 1;
    background: var(--vx-surface);
    border-radius: var(--vx-radius);
}

.vx-notes-item:hover .vx-notes-item-actions {
    opacity: 1;
}

.vx-notes-item-actions .vx-btn-icon {
    width: 28px;
    height: 28px;
    color: var(--vx-text-muted);
}

.vx-notes-item-actions .vx-btn-icon:hover {
    color: var(--vx-danger);
    background: var(--vx-danger-light);
}

.vx-notes-stats {
    padding: 12px 16px;
    border-top: 1px solid var(--vx-border);
    font-size: var(--vx-text-xs);
    color: var(--vx-text-muted);
    text-align: center;
}

/* Editor Area */
.vx-notes-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--vx-bg);
    overflow: hidden;
    position: relative;
}

.vx-notes-main-loading {
    position: absolute;
    inset: 0;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--vx-bg);
}

.vx-notes-main-loading.vx-hidden {
    display: none;
}

.vx-notes-key {
    position: absolute;
    inset: 0;
    z-index: 5;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    background: var(--vx-bg);
    overflow-y: auto;
}

.vx-notes-key-inner {
    max-width: 640px;
    width: 100%;
    margin: 0;
}

.vx-notes-alert {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--vx-radius);
    font-size: var(--vx-text-sm);
    margin-bottom: 10px;
    border: 1px solid var(--vx-border);
}

.vx-notes-alert-warning {
    background: var(--vx-warning-light);
    color: var(--vx-warning);
    border-color: transparent;
}

.vx-notes-alert-danger {
    background: var(--vx-danger-light);
    color: var(--vx-danger);
    border-color: transparent;
}

.vx-notes-key-form-title {
    font-size: 16px;
    font-weight: 600;
    margin: 8px 0;
}

.vx-notes-key-desc {
    margin-top: 12px;
    color: var(--vx-text-secondary);
    font-size: var(--vx-text-sm);
    line-height: 1.6;
}

.vx-notes-key-actions {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 14px;
    flex-wrap: wrap;
}

.vx-notes-placeholder {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

.vx-notes-editor {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.vx-notes-editor-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 24px;
    border-bottom: 1px solid var(--vx-border);
    background: var(--vx-surface);
}

.vx-notes-title-input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: var(--vx-text-2xl);
    font-weight: 600;
    color: var(--vx-text);
    outline: none;
}

.vx-notes-title-input::placeholder {
    color: var(--vx-text-muted);
}

.vx-notes-editor-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.vx-notes-editor-body {
    flex: 1;
    overflow: hidden;
    padding: 12px 16px 16px;
}

/* Make Trumbowyg fill available height */
.vx-notes-editor-body .trumbowyg-box {
    margin: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
}

.vx-notes-editor-body .trumbowyg-editor {
    flex: 1;
    overflow-y: auto;
}

.vx-notes-content-editor {
    flex: 1;
    padding: 24px;
    font-size: var(--vx-text-base);
    line-height: 1.8;
    color: var(--vx-text);
    outline: none;
    overflow-y: auto;
}

.vx-notes-content-editor:empty:before {
    content: attr(placeholder);
    color: var(--vx-text-muted);
}

/* Responsive */
@media (max-width: 768px) {
    .vx-notes-layout {
        flex-direction: column;
        height: calc(100vh - 56px - var(--vx-mobile-bar-height));
    }
    
    .vx-notes-sidebar {
        width: 100%;
        height: 50%;
        border-right: none;
        border-bottom: 1px solid var(--vx-border);
    }
    
    .vx-notes-main {
        height: 50%;
    }
    
    .vx-notes-editor-header {
        padding: 12px 16px;
    }
    
    .vx-notes-title-input {
        font-size: var(--vx-text-lg);
    }
    
    .vx-notes-content-editor {
        padding: 16px;
    }

    .vx-notes-key {
        padding: 14px;
    }

    .vx-notes-key-inner {
        margin: 0;
    }
}

/*
 * IMPORTANT:
 * This template defines display rules (e.g. .vx-notes-sidebar { display:flex })
 * after the global VXUI styles, which can override .vx-hidden.
 * Ensure hidden always wins inside notes module.
 */
#vx-notes-header-actions.vx-hidden,
#vx-notes-sidebar.vx-hidden,
#vx-notes-key.vx-hidden,
#vx-notes-keyfail.vx-hidden,
#vx-notes-keyinit.vx-hidden,
#vx-notes-resetall.vx-hidden,
#vx-notes-placeholder.vx-hidden,
#vx-notes-editor.vx-hidden,
#vx-notes-loading.vx-hidden,
#vx-notes-content.vx-hidden,
#vx-notes-empty.vx-hidden,
#vx-notes-editor-updating.vx-hidden,
#vx-notes-editor-updated.vx-hidden {
    display: none !important;
}
</style>
