<!DOCTYPE HTML>
<html>

<head>
    <title>TMPLINK</title>
    <meta name="description" content="Free and easy to use temporary file transfer station">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta name="renderer" content="webkit" />
    <meta name="theme-color" content="#fff">
    <link rel="manifest" href="/app.webmanifest" />
    <link rel="icon" href="/img/ico/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/img/ico/logo-new.svg" />
    <script type="text/javascript">
        'use strict';

        {
            // IP 地理位置检查
            const { hostname, pathname, search, hash } = window.location;
            if (!hostname.includes('ttttt.link') && 
                hostname !== '127.0.0.1' && 
                hostname !== 'localhost') {
                
                fetch('https://tmp-api.vx-cdn.com/api_v2/token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: 'action=set_area'
                })
                .then(res => {
                    if (res.ok) return res.json();
                    throw new Error('Network response was not ok');
                })
                .then(rsp => {
                    if (rsp?.data === 1) {
                        window.location.href = `https://www.ttttt.link${pathname}${search}${hash}`;
                    }
                })
                .catch(() => {});
            }
        }

        try {
            new Function("class tmpUITest{a=0}");
        } catch (e) {
            window.location.href = '/version.html';
        }

        // 注册 Service Worker (支持 PWA)
        if ('serviceWorker' in navigator) {
            // 尽早监听消息，防止漏掉 SW 的更新通知
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data?.type === 'UPDATE_AVAILABLE') {
                    console.log('New version detected, reloading...');
                    window.location.reload();
                }
            });

            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/pwa_sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                        
                        // 定时检查更新 (每 60 秒)
                        setInterval(() => {
                            if (registration.active) {
                                // console.log('Checking for updates...');
                                registration.active.postMessage({ 
                                    type: 'CHECK_UPDATE',
                                    url: window.location.href 
                                });
                            }
                        }, 60 * 1000);
                    })
                    .catch(error => console.log('SW registration failed:', error));
            });
        }

        // 检查，如果域名开头不是 www. 跳转到 www.
        // 注意：开发环境 (localhost / 127.0.0.1 / IP) 跳过
        {
            const { hostname, pathname, search, hash } = window.location;
            const isIp = /^\d{1,3}(?:\.\d{1,3}){3}$/.test(hostname);

            if (hostname !== 'localhost' && hostname !== '127.0.0.1' && !isIp && !hostname.startsWith('www.')) {
                window.location.href = `https://www.${hostname}${pathname}${search}${hash}`;
            }
        }
    </script>

</head>

<body>
    <div id="tmpui"></div>
    <div id="tmpui_body" class="d-flex flex-column"></div>
    <script type="text/javascript" src="./tmpui.js?v=58"></script>
    <script type="text/javascript">
        let config = {
            "version": 1709,
            "siteroot": "/",
            "loadingIcon": "/img/ico/logo-new.svg",
            "loadingText": "TMP.LINK",
            "errorOnloading": true,
            "googleAnalytics": false,
            "loadingPage": true,
            "loadingProgress": true,
            "pageNotFound": '/404',
            "bg_color_light": "#fff",
            "bg_color_dark": "#363434",
            // "extendStaticHost": 'https://static-tmplink.vx-cdn.com:18088',

            "languageDefault": "en",
            "language": {
                "en": "/json/en.json",
                "cn": "/json/cn.json",
                "hk": "/json/hk.json",
                "jp": "/json/jp.json"
            },

            "preload": {
                "init": {
                    "/plugin/apexcharts/dist/apexcharts.min.js": { "type": "js", "reload": false },

                    "/js/tools/jquery.min.js": { "type": "js", "reload": false },
                    "/js/tools/clipboard.min.js": { "type": "js", "reload": false },
                    "/js/tools/jquery.cookie.js": { "type": "js", "reload": false },
                    "/js/tools/sha1.js": { "type": "js", "reload": false },
                    "/js/tools/base64.js": { "type": "js", "reload": false },
                    "/js/tools/qrcode.min.js": { "type": "js", "reload": false },
                    "/js/tools/jquery.tooltips.js": { "type": "js", "reload": false },
                    "/js/tools/marked.min.js": { "type": "js", "reload": false },
                    "/plugin/bootstrap4.6/js/bootstrap.bundle.min.js": { "type": "js", "reload": false },
                    "/plugin/bootstrap4.6/css/bootstrap.css": { "type": "css", "reload": false },
                    "/plugin/tabler/min.js": { "type": "js", "reload": false },
                    "/plugin/tabler/min.css": { "type": "css", "reload": false },
                    "/plugin/onsnap/js.js": { "type": "js", "reload": false },
                    "/plugin/onsnap/css.css": { "type": "css", "reload": false },
                    "/plugin/trumbowyg/trumbowyg.min.js": { "type": "js", "reload": false },
                    "/plugin/trumbowyg/ui/trumbowyg.min.css": { "type": "css", "reload": false },
                    "/plugin/crypto-js/crypto-js.js": { "type": "js", "reload": false },

                    "/js/core/BoxSelecter.js": { "type": "js", "reload": false },
                    "/js/core/AutoLoader.js": { "type": "js", "reload": false },
                    "/js/core/function.js": { "type": "js", "reload": false },
                    "/js/core/download.js": { "type": "js", "reload": false },
                    "/js/core/download_photo.js": { "type": "js", "reload": false },
                    "/js/core/media.js": { "type": "js", "reload": false },
                    "/js/core/direct.js": { "type": "js", "reload": false },
                    "/js/core/navbar.js": { "type": "js", "reload": false },
                    "/js/core/uploader.js": { "type": "js", "reload": false },
                    "/js/core/stream.js": { "type": "js", "reload": false },
                    "/js/core/notification.js": { "type": "js", "reload": false },
                    "/js/core/giftcard.js": { "type": "js", "reload": false },
                    "/js/core/profile.js": { "type": "js", "reload": false },
                    "/js/core/buy.js": { "type": "js", "reload": false },
                    "/js/core/notes.js": { "type": "js", "reload": false },
                    "/js/core/oauth.js": { "type": "js", "reload": false },
                    "/js/core/dir.js": { "type": "js", "reload": false },
                    "/js/core/chart.js": { "type": "js", "reload": false },
                    "/js/core/file.js": { "type": "js", "reload": false },
                    "/js/core/mobile-file.js": { "type": "js", "reload": false },
                    "/js/core/ai.js": { "type": "js", "reload": false },
                    "/js/core/api.js": { "type": "js", "reload": false },

                    "/css/reset.css": { "type": "css", "reload": false },
                    "/css/index.css": { "type": "css", "reload": false },
                    "/css/sp.css": { "type": "css", "reload": false },
                    "/css/fa.css": { "type": "css", "reload": false },
                    "/css/dark.css": { "type": "css", "reload": false },
                    "/css/sponsor.css": { "type": "css", "reload": false },
                    "/css/user-info-card.css": { "type": "css", "reload": false },
                    "/css/prism.css": { "type": "css", "reload": false },
                    "/css/modern-auth.css": { "type": "css", "reload": false },
                    "/css/modern-modal.css": { "type": "css", "reload": false },
                    "/css/move-folder-modal.css": { "type": "css", "reload": false },
                    "/tpl/include/gtpl.html": { "type": "tpl", "reload": false },

                    "/js/core/tmplink.js": { "type": "js", "reload": false },
                    "/js/init/init.js": { "type": "js" }
                },
                "vxui_init": {
                    "/plugin/apexcharts/dist/apexcharts.min.js": { "type": "js", "reload": false },

                    "/js/tools/jquery.min.js": { "type": "js", "reload": false },
                    "/js/tools/clipboard.min.js": { "type": "js", "reload": false },
                    "/js/tools/jquery.cookie.js": { "type": "js", "reload": false },
                    "/js/tools/sha1.js": { "type": "js", "reload": false },
                    "/js/tools/base64.js": { "type": "js", "reload": false },
                    "/js/tools/marked.min.js": { "type": "js", "reload": false },
                    "/plugin/crypto-js/crypto-js.js": { "type": "js", "reload": false },
                    "/plugin/trumbowyg/trumbowyg.min.js": { "type": "js", "reload": false },
                    "/plugin/trumbowyg/ui/trumbowyg.min.css": { "type": "css", "reload": false },

                    "/css/reset.css": { "type": "css", "reload": false },
                    "/css/index.css": { "type": "css", "reload": false },
                    "/css/sp.css": { "type": "css", "reload": false },
                    "/css/fa.css": { "type": "css", "reload": false },
                    "/css/dark.css": { "type": "css", "reload": false },
                    "/css/sponsor.css": { "type": "css", "reload": false },
                    "/tpl/include/gtpl.html": { "type": "tpl", "reload": false },

                    "/js/core/function.js": { "type": "js", "reload": false },
                    "/js/core/api.js": { "type": "js", "reload": false }
                },

                "file_init": {
                    "/js/tools/jquery.min.js": { "type": "js", "reload": false },
                    "/js/tools/clipboard.min.js": { "type": "js", "reload": false },
                    "/js/tools/jquery.cookie.js": { "type": "js", "reload": false },
                    "/js/tools/sha1.js": { "type": "js", "reload": false },
                    "/js/tools/base64.js": { "type": "js", "reload": false },
                    "/js/tools/qrcode.min.js": { "type": "js", "reload": false },

                    "/js/core/function.js": { "type": "js", "reload": false },
                    "/js/core/stream.js": { "type": "js", "reload": false },
                    "/js/core/api.js": { "type": "js", "reload": false },
                    "/js/file.js": { "type": "js", "reload": false },

                    "/css/reset.css": { "type": "css", "reload": false },
                    "/css/sp.css": { "type": "css", "reload": false },
                    "/css/fa.css": { "type": "css", "reload": false },
                    "/css/dark.css": { "type": "css", "reload": false },
                    "/css/sponsor.css": { "type": "css", "reload": false },
                    "/css/file.css": { "type": "css", "reload": false },
                    "/css/user-info-card.css": { "type": "css", "reload": false },
                    "/tpl/include/gtpl.html": { "type": "tpl", "reload": false }
                },
                "auth_init": {
                    "/js/tools/jquery.min.js": { "type": "js", "reload": false },
                    "/js/tools/jquery.cookie.js": { "type": "js", "reload": false },
                    "/js/tools/sha1.js": { "type": "js", "reload": false },
                    "/js/tools/base64.js": { "type": "js", "reload": false },

                    "/js/core/function.js": { "type": "js", "reload": false },
                    "/js/core/api.js": { "type": "js", "reload": false },
                    "/js/core/oauth.js": { "type": "js", "reload": false },
                    "/js/auth.js": { "type": "js", "reload": false },

                    "/css/reset.css": { "type": "css", "reload": false },
                    "/css/sp.css": { "type": "css", "reload": false },
                    "/css/fa.css": { "type": "css", "reload": false },
                    "/css/dark.css": { "type": "css", "reload": false },
                    "/css/sponsor.css": { "type": "css", "reload": false },
                    "/css/file.css": { "type": "css", "reload": false },
                    "/css/auth.css": { "type": "css", "reload": false },
                    "/tpl/include/gtpl.html": { "type": "tpl", "reload": false }
                }
            },
            "append": {
                "tmplink": {
                    "/tpl/include/head.html": { "type": "html", "target": { "type": "id", "val": "tpl_header" } },
                    "/tpl/include/foot.html": { "type": "html", "target": { "type": "id", "val": "tpl_footer" } },
                    "/tpl/include/model.html": { "type": "html", "target": { "type": "id", "val": "tpl_model" } }
                }
            },
            "path": {
                "/app": {
                    "title": "TMP.link",
                    "preload": ["init"],
                    "append": ["tmplink"],
                    "body": {

                        "/js/init/init_direct.js": { "type": "js" },
                        "/js/init/init_room.js": { "type": "js" },
                        "/js/init/init_login.js": { "type": "js" },
                        "/js/init/init_reg.js": { "type": "js" },
                        "/js/init/init_reset.js": { "type": "js" },
                        "/js/init/init_tos.js": { "type": "js" },
                        "/js/init/init_privacy.js": { "type": "js" },
                        "/js/init/init_notes.js": { "type": "js" },
                        "/js/init/init_ai.js": { "type": "js" },
                        "/js/init/init_photo.js": { "type": "js" },

                        "/tpl/listview/direct.html": { "type": "file" },
                        "/tpl/listview/room.html": { "type": "file" },
                        "/tpl/listview/index.html": { "type": "file" },
                        "/tpl/listview/login.html": { "type": "file" },
                        "/tpl/listview/reg.html": { "type": "file" },
                        "/tpl/listview/reset.html": { "type": "file" },
                        "/tpl/listview/tos.html": { "type": "file" },
                        "/tpl/listview/privacy.html": { "type": "file" },
                        "/tpl/listview/notes.html": { "type": "file" },
                        "/tpl/listview/photo.html": { "type": "file" },

                        "/tpl/listview/mobile_direct.html": { "type": "file" },
                        "/tpl/listview/mobile_room.html": { "type": "file" },
                        "/tpl/listview/mobile_notes.html": { "type": "file" },
                        "/tpl/listview/mobile_login.html": { "type": "file" },
                        "/tpl/listview/mobile_reg.html": { "type": "file" },
                        "/tpl/listview/ai.html": { "type": "file" },
                        "/tpl/listview/mobile_ai.html": { "type": "file" },
                        "/tpl/listview/mobile_photo.html": { "type": "file" },

                        "/tpl/dynamic.html": { "type": "html", "target": { "type": "body" } },
                        "/js/core/dynamic.js": { "type": "js", "reload": false },
                        "/js/init/init_dynamic.js": { "type": "js" },

                        "/css/ai.css": { "type": "css", "reload": false },
                        "/css/photo-album.css": { "type": "css", "reload": false },
                    }
                },
                "/": {
                    "title": "TMP.link - Welcome",
                    "body": {
                        "/tpl/index.html": { "type": "html", "target": { "type": "body" } },
                        "/js/init/init_index.js": { "type": "js" },
                        "/css/refined-index.css": { "type": "css" },
                        "/css/fa.css": { "type": "css" },
                        "/css/dark.css": { "type": "css", "reload": false },
                        "/css/sponsor.css": { "type": "css", "reload": false }
                    }
                },
                "/room": {
                    "title": "TMP.link - Redirect Room",
                    "body": {
                        "/js/init/redirect_home.js": { "type": "js" }
                    }
                },
                "/about": {
                    "title": "TMP.link -About",
                    "preload": ["init"],
                    "append": ["tmplink"],
                    "body": {
                        "/tpl/about.html": { "type": "html", "target": { "type": "body" } }
                    }
                },
                "/503": {
                    "title": "TMP.link - 503",
                    "preload": ["init"],
                    "append": ["tmplink"],
                    "body": {
                        "/css/file.css": { "type": "css", "reload": false },
                        "/tpl/503.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/503_mobile.html": { "type": "file" },
                        "/js/init/init_503.js": { "type": "js" }
                    }
                },
                "/404": {
                    "title": "TMP.link - 404",
                    "preload": ["init"],
                    "append": ["tmplink"],
                    "body": {
                        "/css/file.css": { "type": "css", "reload": false },
                        "/tpl/404.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/404_mobile.html": { "type": "file" },
                        "/js/init/init_404.js": { "type": "js" }
                    }
                },
                "/403": {
                    "title": "TMP.link - 403",
                    "preload": ["init"],
                    "append": ["tmplink"],
                    "body": {
                        "/css/file.css": { "type": "css", "reload": false },
                        "/tpl/403.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/403_mobile.html": { "type": "file" },
                        "/js/init/init_403.js": { "type": "js" }
                    }
                },
                "/504": {
                    "title": "TMP.link - 504",
                    "preload": ["init"],
                    "append": ["tmplink"],
                    "body": {
                        "/css/file.css": { "type": "css", "reload": false },
                        "/tpl/504.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/504_mobile.html": { "type": "file" },
                        "/js/init/init_504.js": { "type": "js" }
                    }
                },
                "/file": {
                    "title": "TMP.link - Download",
                    "preload": ["file_init"],
                    "body": {
                        "/js/init/init_file.js": { "type": "js" },
                        "/tpl/file.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/file_desktop.html": { "type": "file" },
                        "/tpl/file_mobile.html": { "type": "file" }
                    }
                },
                "/login": {
                    "title": "TMP.link - Login",
                    "preload": ["auth_init"],
                    "body": {
                        "/tpl/auth.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/auth_login.html": { "type": "file" },
                        "/tpl/auth_login_mobile.html": { "type": "file" },
                        "/js/init/init_auth.js": { "type": "js" }
                    }
                },
                "/reg": {
                    "title": "TMP.link - Register",
                    "preload": ["auth_init"],
                    "body": {
                        "/tpl/auth.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/auth_reg.html": { "type": "file" },
                        "/tpl/auth_reg_mobile.html": { "type": "file" },
                        "/js/init/init_auth.js": { "type": "js" }
                    }
                },
                "/reset": {
                    "title": "TMP.link - Reset Password",
                    "preload": ["auth_init"],
                    "body": {
                        "/tpl/auth.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/auth_reset.html": { "type": "file" },
                        "/tpl/auth_reset_mobile.html": { "type": "file" },
                        "/js/init/init_auth.js": { "type": "js" }
                    }
                },
                "/vx": {
                    "title": "TMP.link - VXUI",
                    "preload": ["vxui_init"],
                    "body": {
                        "/css/vxui/vxui.css": { "type": "css", "reload": false },
                        "/css/vxui/account.css": { "type": "css", "reload": false },
                        "/css/photo-album.css": { "type": "css", "reload": false },
                        "/js/vxui/vxui-core.js": { "type": "js" },
                        "/js/vxui/vxui-direct.js": { "type": "js" },
                        "/js/vxui/vxui-notes.js": { "type": "js" },
                        "/js/vxui/vxui-uploader.js": { "type": "js" },
                        "/js/vxui/vxui-download.js": { "type": "js" },
                        "/js/vxui/vxui-filelist.js": { "type": "js" },
                        "/js/vxui/vxui-ai.js": { "type": "js" },
                        "/js/vxui/vxui-shop.js": { "type": "js" },
                        "/js/vxui/vxui-account.js": { "type": "js" },
                        "/js/init/init_vx_direct.js": { "type": "js" },
                        "/js/init/init_vx_notes.js": { "type": "js" },
                        "/js/init/init_vx_filelist.js": { "type": "js" },
                        "/js/init/init_vx_ai.js": { "type": "js" },
                        "/js/init/init_vx_shop.js": { "type": "js" },
                        "/js/init/init_vx_account.js": { "type": "js" },
                        "/js/init/init_vx.js": { "type": "js" },
                        "/tpl/vxui/index.html": { "type": "html", "target": { "type": "body" } },
                        "/tpl/vxui/direct.html": { "type": "file" },
                        "/tpl/vxui/notes.html": { "type": "file" },
                        "/tpl/vxui/filelist.html": { "type": "file" },
                        "/tpl/vxui/ai.html": { "type": "file" },
                        "/tpl/vxui/shop.html": { "type": "file" },
                        "/tpl/vxui/profile.html": { "type": "file" },
                        "/tpl/vxui/settings.html": { "type": "file" }
                    }
                }
            }
        };
        if (window.location.host === 'www.ttttt.link') {
            config.extendStaticHost = 'https://res.cntmp.link';
        }
        const app = new tmpUI(config);
    </script>
    <script type="text/javascript" src="/plugin/icon/lib.js"></script>
    <!-- reCAPTCHA temporarily disabled -->
    <!-- <script async type="text/javascript"
        src="https://www.recaptcha.net/recaptcha/api.js?render=6LfqxcsUAAAAABAABxf4sIs8CnHLWZO4XDvRJyN5"></script> -->
</body>

</html>
